import Image from "@/components/ui/image"
import { memo, useCallback, useMemo } from "@/lib/memo"
import View from "@/components/ui/view"
import { cn } from "@filen/utils"
import { useState } from "react"

export const AVATAR_FALLBACK_BASE64_DATA_URI =
	"data:image/png;base64,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"

export const Avatar = memo((props: { size?: number; source?: React.ComponentProps<typeof Image>["source"]; className?: string }) => {
	const [hasError, setHasError] = useState<boolean>(false)

	const size = useMemo(() => props.size ?? 40, [props.size])

	const onError = useCallback(() => {
		setHasError(true)
	}, [])

	const onLoad = useCallback(() => {
		setHasError(false)
	}, [])

	return (
		<View
			className={cn("flex-row overflow-hidden rounded-full bg-background-secondary items-center justify-center", props.className)}
			style={{
				width: size,
				height: size
			}}
		>
			<Image
				source={
					hasError || !props.source
						? {
								uri: AVATAR_FALLBACK_BASE64_DATA_URI
							}
						: props.source
				}
				onError={onError}
				onLoad={onLoad}
				style={{
					width: size,
					height: size
				}}
				contentFit="contain"
			/>
		</View>
	)
})

export default Avatar
